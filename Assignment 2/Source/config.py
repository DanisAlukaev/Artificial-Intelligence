# Solution for the Home Assignment 2.
# Student:    Danis Alukaev
# Group:      BS19-02
# Student ID: 19BS551

from PIL import Image
import numpy as np
from math import floor

# input image
PATH_ORIGINAL_IMAGE = "documents/input/Mona Lisa.jpg"
ORIGINAL_IMAGE = np.asarray(Image.open(PATH_ORIGINAL_IMAGE), dtype=np.int32)
IMAGE_SIZE = ORIGINAL_IMAGE.shape[:2]
FILE_NAME = PATH_ORIGINAL_IMAGE.split('/')[-1][:-4]

# number of individuals in population
POPULATION_SIZE = 100
# elite group size
ELITE_SIZE = 24
# number of mutations
MUTATIONS_NUMBER = 2

# number of generations
GENERATIONS_NUMBER = 100_000
# number of genes
GENES_NUMBER = floor(max(IMAGE_SIZE[0], IMAGE_SIZE[1]) * 4)

# minimal font
MIN_FONT = 30
# maximal font
MAX_FONT = 100

# number of cores
CORES_NUMBER = 8

# palette is used to approximate the image using certain set of colors (if it is not specified the program will exploit
# entire color space)
# this palette cannot be generated dynamically as it will cause high memory overhead for concurrent processes
# consequently, algorithm for palette generation was developed as a separate module called pallete
# follow /modules/palette/palette.py for more details

PALETTE_MONA_LISA = [(131, 139, 87), (134, 142, 89), (132, 139, 83), (133, 140, 82), (139, 139, 82), (134, 135, 84),
                     (131, 131, 83), (130, 133, 82), (124, 128, 79), (131, 142, 90), (127, 135, 82), (129, 135, 83),
                     (129, 137, 88), (78, 48, 27), (116, 77, 30), (62, 33, 21), (147, 152, 98), (107, 73, 31),
                     (146, 150, 92), (140, 150, 100), (144, 149, 96), (149, 152, 98), (50, 29, 25), (138, 147, 95),
                     (130, 129, 77), (134, 142, 92), (35, 18, 24), (192, 153, 65), (152, 110, 39), (184, 144, 65),
                     (158, 159, 102), (157, 158, 100), (152, 159, 105), (223, 183, 94), (118, 79, 34), (71, 42, 27),
                     (142, 151, 101), (149, 156, 103), (154, 157, 111), (27, 14, 24), (99, 71, 42), (217, 177, 87),
                     (43, 21, 26), (162, 164, 111), (173, 133, 57), (156, 159, 103), (132, 138, 86), (146, 155, 100),
                     (173, 173, 112), (102, 110, 69), (204, 162, 79), (74, 41, 37), (29, 16, 29), (94, 58, 33),
                     (114, 130, 85), (166, 122, 57), (103, 118, 79), (171, 173, 120), (40, 21, 33), (75, 84, 58),
                     (132, 89, 46), (154, 155, 106), (155, 112, 51), (79, 97, 71), (126, 127, 79), (95, 99, 64),
                     (91, 78, 54), (75, 88, 62), (34, 21, 35), (158, 117, 52), (204, 160, 76), (193, 148, 67),
                     (109, 106, 67), (72, 32, 29), (33, 23, 33), (216, 171, 84), (81, 79, 54), (41, 23, 32),
                     (180, 137, 67), (208, 164, 82), (78, 83, 57), (129, 88, 43), (82, 47, 29), (155, 108, 52),
                     (98, 113, 80), (59, 30, 32), (173, 131, 62), (66, 64, 48), (57, 58, 47), (68, 80, 62),
                     (133, 88, 43), (46, 25, 30), (31, 22, 34), (79, 81, 59), (79, 76, 54), (64, 27, 30), (74, 49, 40),
                     (114, 74, 38), (192, 146, 69), (158, 115, 53), (70, 41, 29), (84, 86, 61), (33, 22, 32),
                     (75, 78, 56), (41, 23, 28), (77, 87, 62), (53, 30, 30), (38, 27, 32), (55, 24, 29), (94, 61, 36),
                     (106, 112, 80), (64, 73, 54), (35, 20, 27), (70, 41, 28), (88, 94, 62), (109, 74, 34),
                     (99, 106, 81), (93, 93, 63), (93, 99, 75), (163, 128, 62), (68, 43, 33), (132, 96, 43),
                     (81, 48, 35), (39, 24, 31), (58, 30, 25), (152, 115, 47), (97, 58, 31), (77, 73, 46), (95, 77, 42),
                     (62, 46, 37), (69, 55, 37), (188, 152, 71), (45, 27, 36), (189, 150, 66), (206, 169, 82),
                     (54, 30, 28), (224, 186, 93), (53, 31, 32), (81, 66, 37), (83, 58, 35), (192, 150, 61),
                     (56, 29, 35), (218, 180, 90), (230, 192, 97), (160, 114, 50), (96, 54, 27), (110, 81, 38),
                     (118, 82, 40), (76, 47, 34), (126, 91, 38), (137, 95, 40), (47, 28, 36), (38, 23, 35),
                     (233, 199, 106), (211, 171, 75), (234, 201, 110), (231, 196, 99)]

PALETTE_CHARLES_DARWIN = [(21, 14, 16), (24, 14, 16), (22, 15, 16), (26, 18, 18), (23, 15, 17), (25, 15, 16),
                          (27, 17, 17), (26, 16, 16), (156, 116, 103), (116, 78, 63), (148, 119, 109), (90, 57, 38),
                          (30, 18, 17), (26, 18, 19), (27, 17, 16), (23, 16, 16), (75, 53, 40), (214, 185, 180),
                          (31, 20, 21), (25, 16, 17), (29, 18, 17), (189, 149, 136), (83, 53, 38), (158, 113, 101),
                          (34, 24, 21), (58, 40, 31), (120, 78, 63), (169, 144, 140), (28, 18, 19), (26, 17, 18),
                          (28, 18, 17), (81, 50, 37), (198, 168, 161), (48, 35, 29), (31, 21, 20), (56, 32, 24),
                          (29, 19, 19), (67, 39, 33), (29, 19, 17), (30, 19, 17), (37, 21, 19), (208, 185, 178),
                          (67, 48, 37), (157, 116, 104), (30, 20, 20), (32, 22, 20), (197, 156, 151), (28, 18, 18),
                          (34, 20, 18), (61, 33, 24), (68, 39, 31), (37, 25, 22), (178, 146, 135), (64, 45, 37),
                          (28, 17, 18), (31, 19, 17), (36, 21, 19), (95, 66, 52), (202, 182, 176), (34, 24, 23),
                          (170, 143, 132), (25, 15, 17), (90, 63, 43), (19, 14, 19), (45, 34, 35), (194, 173, 164),
                          (18, 12, 16), (65, 46, 33), (82, 59, 44), (16, 11, 17), (146, 118, 106), (15, 10, 14),
                          (20, 14, 20), (120, 92, 76), (117, 90, 70), (99, 83, 101), (39, 30, 32), (14, 9, 14),
                          (182, 156, 142), (17, 12, 18), (156, 131, 122), (21, 11, 15), (15, 10, 15), (59, 41, 30),
                          (117, 92, 77), (27, 18, 21), (18, 12, 17), (120, 92, 77), (18, 12, 18), (16, 11, 16),
                          (16, 10, 15), (17, 10, 14), (18, 11, 16), (121, 98, 85), (23, 14, 19), (19, 11, 15),
                          (22, 14, 17), (19, 10, 13), (29, 18, 20), (23, 14, 15)]

PALETTE_MANDRILL = [(123, 138, 103), (98, 110, 93), (61, 60, 47), (81, 86, 70), (140, 94, 70), (82, 103, 103),
                    (76, 81, 71), (170, 125, 34), (168, 106, 31), (91, 112, 114), (127, 128, 87), (135, 190, 223),
                    (144, 188, 218), (231, 91, 58), (94, 120, 111), (108, 182, 228), (117, 189, 234), (224, 107, 102),
                    (162, 197, 224), (132, 189, 226), (151, 195, 228), (115, 190, 235), (163, 192, 217),
                    (116, 178, 224), (243, 74, 31), (106, 126, 92), (235, 85, 61), (164, 193, 221), (106, 103, 74),
                    (131, 186, 227), (156, 189, 219), (86, 101, 75), (64, 63, 48), (95, 111, 82), (145, 137, 83),
                    (128, 177, 216), (240, 69, 35), (148, 165, 198), (160, 170, 199), (109, 166, 215), (191, 154, 74),
                    (56, 61, 57), (88, 96, 68), (100, 113, 88), (134, 117, 60), (86, 116, 149), (240, 85, 65),
                    (241, 77, 52), (118, 160, 207), (105, 108, 83), (88, 93, 76), (217, 183, 77), (93, 117, 143),
                    (100, 116, 113), (122, 124, 102), (191, 101, 98), (178, 99, 93), (125, 133, 111), (220, 178, 65),
                    (220, 110, 112), (184, 147, 66), (220, 93, 79), (108, 116, 105), (123, 147, 145), (236, 92, 82),
                    (166, 149, 93), (137, 147, 149), (201, 180, 102), (130, 147, 129), (153, 160, 164), (218, 103, 90),
                    (119, 123, 102), (156, 159, 123), (160, 147, 150), (164, 147, 118), (172, 170, 166),
                    (170, 169, 130), (167, 151, 90), (119, 118, 89), (116, 131, 127), (127, 134, 132), (192, 147, 140),
                    (123, 138, 134), (200, 116, 108), (125, 113, 78), (142, 151, 132), (107, 106, 69), (156, 151, 126),
                    (190, 162, 154), (100, 101, 94), (176, 166, 130)]

PALETTE_JOSEPH_ALEXANDER_BROWN = [(108, 118, 116), (40, 51, 56), (62, 76, 79), (73, 79, 76), (45, 53, 61), (54, 74, 86),
                                  (62, 78, 89), (65, 79, 92), (51, 60, 71), (66, 80, 81), (31, 37, 50), (109, 122, 125),
                                  (63, 67, 76), (85, 102, 119), (45, 47, 53), (41, 45, 54), (94, 99, 105), (85, 90, 89),
                                  (225, 196, 176), (74, 83, 79), (210, 192, 175), (245, 236, 222), (142, 149, 152),
                                  (38, 47, 67), (31, 37, 59), (194, 157, 137), (89, 97, 110), (75, 83, 90),
                                  (65, 73, 95), (52, 58, 79), (134, 139, 140), (182, 178, 172), (115, 115, 111),
                                  (238, 211, 192), (224, 191, 172), (164, 138, 118), (194, 156, 137), (179, 147, 128),
                                  (113, 118, 130), (136, 132, 129), (174, 172, 164), (208, 183, 163), (164, 151, 136),
                                  (226, 222, 212), (245, 225, 214), (131, 96, 81), (216, 214, 202), (247, 246, 237),
                                  (255, 255, 254), (49, 34, 28), (75, 50, 40), (252, 251, 249), (254, 254, 250),
                                  (253, 254, 247), (81, 49, 39), (151, 120, 100), (160, 130, 111), (253, 254, 248),
                                  (203, 161, 143), (248, 247, 239), (241, 239, 230), (142, 97, 82), (210, 174, 154),
                                  (255, 255, 253), (254, 255, 250), (149, 98, 83), (255, 255, 255), (165, 118, 98),
                                  (95, 54, 43), (79, 40, 30), (115, 68, 52), (253, 252, 249), (132, 103, 85),
                                  (216, 203, 193), (253, 253, 247), (37, 17, 12), (78, 49, 36), (254, 254, 254),
                                  (108, 72, 56), (69, 37, 28), (169, 138, 113), (100, 87, 73), (253, 253, 250),
                                  (253, 253, 252), (25, 23, 19), (134, 24, 16), (192, 153, 132), (114, 68, 54),
                                  (165, 117, 99), (56, 126, 91), (248, 248, 246), (188, 187, 174), (130, 110, 85),
                                  (76, 52, 39), (92, 77, 56), (127, 86, 67), (144, 115, 92), (47, 98, 66), (22, 71, 42),
                                  (48, 36, 24), (120, 122, 117), (35, 150, 106), (148, 117, 95), (115, 79, 60),
                                  (51, 7, 3), (8, 39, 21), (16, 18, 18), (28, 32, 33), (5, 26, 13), (189, 66, 52),
                                  (14, 67, 39), (55, 142, 105), (17, 111, 71), (40, 142, 101), (13, 75, 42),
                                  (195, 154, 139), (12, 14, 13), (21, 115, 73), (11, 11, 10), (22, 139, 94),
                                  (38, 165, 121), (196, 55, 48), (25, 140, 95), (18, 125, 80), (23, 143, 98),
                                  (84, 72, 58), (21, 144, 99), (21, 146, 101), (34, 38, 37), (21, 136, 91),
                                  (21, 117, 73), (18, 131, 86), (31, 130, 89)]

PALETTE_HEAD = [(1, 58, 83), (1, 65, 90), (1, 71, 96), (1, 77, 100), (1, 81, 105), (1, 84, 107), (1, 89, 111),
                (1, 86, 109), (2, 87, 109), (4, 84, 106), (1, 79, 102), (1, 65, 91), (1, 96, 117), (72, 85, 80),
                (1, 83, 106), (1, 75, 99), (1, 81, 104), (1, 87, 110), (1, 93, 115), (1, 74, 98), (7, 91, 111),
                (80, 105, 91), (1, 72, 97), (1, 73, 97), (1, 97, 117), (1, 93, 114), (1, 90, 112), (1, 104, 123),
                (78, 110, 103), (5, 101, 120), (66, 46, 40), (1, 80, 103), (1, 99, 119), (1, 106, 125), (1, 91, 112),
                (22, 113, 124), (1, 101, 120), (23, 91, 105), (1, 100, 119), (1, 85, 107), (1, 96, 116), (1, 106, 123),
                (7, 112, 128), (116, 94, 77), (3, 111, 129), (96, 72, 72), (195, 181, 150), (151, 133, 112),
                (51, 30, 27), (191, 176, 153), (1, 90, 111), (3, 113, 129), (1, 103, 121), (1, 102, 120),
                (53, 123, 127), (69, 42, 44), (110, 79, 77), (41, 24, 28), (9, 106, 120), (1, 94, 114), (1, 105, 123),
                (106, 76, 77), (6, 115, 130), (184, 165, 129), (200, 186, 155), (108, 83, 72), (182, 165, 145),
                (16, 101, 113), (3, 108, 124), (1, 95, 115), (1, 96, 115), (73, 46, 40), (61, 41, 38), (55, 32, 34),
                (93, 59, 60), (171, 154, 127), (136, 112, 100), (166, 149, 123), (121, 90, 94), (18, 92, 104),
                (82, 52, 49), (1, 95, 114), (132, 104, 100), (181, 165, 138), (35, 22, 23), (44, 26, 30),
                (31, 116, 130), (81, 49, 50), (75, 52, 47), (41, 108, 123), (1, 92, 112), (121, 88, 86), (2, 105, 122),
                (80, 50, 40), (10, 96, 114), (17, 117, 130), (25, 109, 124), (68, 45, 41), (133, 96, 84), (3, 109, 124),
                (1, 98, 117), (1, 88, 108), (92, 75, 70), (130, 92, 74), (55, 32, 36), (111, 81, 85), (3, 114, 128),
                (3, 114, 129), (43, 100, 117), (104, 73, 67), (46, 108, 123), (14, 110, 125), (187, 170, 140),
                (1, 105, 120), (1, 83, 104), (1, 94, 112), (111, 79, 79), (155, 134, 113), (6, 109, 122), (4, 105, 120),
                (123, 94, 85), (93, 68, 75), (4, 103, 119), (5, 93, 110), (7, 95, 113), (6, 85, 105), (3, 75, 96),
                (17, 88, 105), (108, 82, 87), (17, 103, 116), (1, 91, 110), (164, 143, 120), (7, 85, 105), (7, 78, 99),
                (178, 156, 122), (1, 95, 113), (158, 136, 115), (136, 95, 46), (196, 182, 150), (170, 148, 116)]

# set new palette here
PALETTE = PALETTE_MONA_LISA
